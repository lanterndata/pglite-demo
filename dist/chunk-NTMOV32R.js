import{a as M,b as Pt,c as U,d as l,e as y,f as w,g as p,h as d,i as m,j as _t,m as St,n as Ot,o as It,p as Ct,q as Rt,s as Dt,v as Mt,w as At}from"./chunk-THKM2UGU.js";var q=M(f=>{"use strict";m();Object.defineProperty(f,"__esModule",{value:!0});f.NoticeMessage=f.DataRowMessage=f.CommandCompleteMessage=f.ReadyForQueryMessage=f.NotificationResponseMessage=f.BackendKeyDataMessage=f.AuthenticationMD5Password=f.ParameterStatusMessage=f.ParameterDescriptionMessage=f.RowDescriptionMessage=f.Field=f.CopyResponse=f.CopyDataMessage=f.DatabaseError=f.copyDone=f.emptyQuery=f.replicationStart=f.portalSuspended=f.noData=f.closeComplete=f.bindComplete=f.parseComplete=void 0;f.parseComplete={name:"parseComplete",length:5};f.bindComplete={name:"bindComplete",length:5};f.closeComplete={name:"closeComplete",length:5};f.noData={name:"noData",length:5};f.portalSuspended={name:"portalSuspended",length:5};f.replicationStart={name:"replicationStart",length:4};f.emptyQuery={name:"emptyQuery",length:4};f.copyDone={name:"copyDone",length:4};var Be=class extends Error{constructor(e,t,s){super(e),this.length=t,this.name=s}};f.DatabaseError=Be;var Fe=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};f.CopyDataMessage=Fe;var ke=class{constructor(e,t,s,i){this.length=e,this.name=t,this.binary=s,this.columnTypes=new Array(i)}};f.CopyResponse=ke;var Ne=class{constructor(e,t,s,i,n,a,c){this.name=e,this.tableID=t,this.columnID=s,this.dataTypeID=i,this.dataTypeSize=n,this.dataTypeModifier=a,this.format=c}};f.Field=Ne;var Ue=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};f.RowDescriptionMessage=Ue;var qe=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};f.ParameterDescriptionMessage=qe;var Ge=class{constructor(e,t,s){this.length=e,this.parameterName=t,this.parameterValue=s,this.name="parameterStatus"}};f.ParameterStatusMessage=Ge;var ze=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};f.AuthenticationMD5Password=ze;var je=class{constructor(e,t,s){this.length=e,this.processID=t,this.secretKey=s,this.name="backendKeyData"}};f.BackendKeyDataMessage=je;var Qe=class{constructor(e,t,s,i){this.length=e,this.processId=t,this.channel=s,this.payload=i,this.name="notification"}};f.NotificationResponseMessage=Qe;var $e=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};f.ReadyForQueryMessage=$e;var Ve=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};f.CommandCompleteMessage=Ve;var He=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};f.DataRowMessage=He;var We=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};f.NoticeMessage=We});var Qt=M(Pe=>{"use strict";m();Object.defineProperty(Pe,"__esModule",{value:!0});Pe.Writer=void 0;var ot=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=d.allocUnsafe(e)}ensure(e){var t=this.buffer.length-this.offset;if(t<e){var s=this.buffer,i=s.length+(s.length>>1)+e;this.buffer=d.allocUnsafe(i),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{var t=d.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){var t=d.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){var t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=d.allocUnsafe(this.size),t}};Pe.Writer=ot});var Vt=M(Se=>{"use strict";m();Object.defineProperty(Se,"__esModule",{value:!0});Se.serialize=void 0;var ct=Qt(),g=new ct.Writer,Js=r=>{g.addInt16(3).addInt16(0);for(let s of Object.keys(r))g.addCString(s).addCString(r[s]);g.addCString("client_encoding").addCString("UTF8");var e=g.addCString("").flush(),t=e.length+4;return new ct.Writer().addInt32(t).add(e).flush()},Zs=()=>{let r=d.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},er=r=>g.addCString(r).flush(112),tr=function(r,e){return g.addCString(r).addInt32(d.byteLength(e)).addString(e),g.flush(112)},sr=function(r){return g.addString(r).flush(112)},rr=r=>g.addCString(r).flush(81),$t=[],ir=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||$t;for(var s=t.length,i=g.addCString(e).addCString(r.text).addInt16(s),n=0;n<s;n++)i.addInt32(t[n]);return g.flush(80)},G=new ct.Writer,nr=function(r,e){for(let t=0;t<r.length;t++){let s=e?e(r[t],t):r[t];s==null?(g.addInt16(0),G.addInt32(-1)):s instanceof d?(g.addInt16(1),G.addInt32(s.length),G.add(s)):(g.addInt16(0),G.addInt32(d.byteLength(s)),G.addString(s))}},ar=(r={})=>{let e=r.portal||"",t=r.statement||"",s=r.binary||!1,i=r.values||$t,n=i.length;return g.addCString(e).addCString(t),g.addInt16(n),nr(i,r.valueMapper),g.addInt16(n),g.add(G.flush()),g.addInt16(s?1:0),g.flush(66)},or=d.from([69,0,0,0,9,0,0,0,0,0]),cr=r=>{if(!r||!r.portal&&!r.rows)return or;let e=r.portal||"",t=r.rows||0,s=d.byteLength(e),i=4+s+1+4,n=d.allocUnsafe(1+i);return n[0]=69,n.writeInt32BE(i,1),n.write(e,5,"utf-8"),n[s+5]=0,n.writeUInt32BE(t,n.length-4),n},ur=(r,e)=>{let t=d.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},ut=(r,e)=>{let s=4+d.byteLength(e)+1,i=d.allocUnsafe(1+s);return i[0]=r,i.writeInt32BE(s,1),i.write(e,5,"utf-8"),i[s]=0,i},lr=g.addCString("P").flush(68),fr=g.addCString("S").flush(68),hr=r=>r.name?ut(68,`${r.type}${r.name||""}`):r.type==="P"?lr:fr,dr=r=>{let e=`${r.type}${r.name||""}`;return ut(67,e)},pr=r=>g.add(r).flush(100),yr=r=>ut(102,r),_e=r=>d.from([r,0,0,0,4]),mr=_e(72),gr=_e(83),wr=_e(88),br=_e(99),Er={startup:Js,password:er,requestSsl:Zs,sendSASLInitialResponseMessage:tr,sendSCRAMClientFinalMessage:sr,query:rr,parse:ir,bind:ar,execute:cr,describe:hr,close:dr,flush:()=>mr,sync:()=>gr,end:()=>wr,copyData:pr,copyDone:()=>br,copyFail:yr,cancel:ur};Se.serialize=Er});var Ht=M(Oe=>{"use strict";m();Object.defineProperty(Oe,"__esModule",{value:!0});Oe.BufferReader=void 0;var Tr=d.allocUnsafe(0),lt=class{constructor(e=0){this.offset=e,this.buffer=Tr,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};Oe.BufferReader=lt});var Wt=M(()=>{"use strict";m()});var dt=M(z=>{"use strict";m();var xr=z&&z.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(z,"__esModule",{value:!0});z.Parser=void 0;var b=q(),vr=Ht(),Pr=xr(Wt()),ft=1,_r=4,Kt=ft+_r,Yt=d.allocUnsafe(0),ht=class{constructor(e){if(this.buffer=Yt,this.bufferLength=0,this.bufferOffset=0,this.reader=new vr.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,i=this.bufferOffset;for(;i+Kt<=s;){let n=this.buffer[i],a=this.buffer.readUInt32BE(i+ft),c=ft+a;if(c+i<=s){let o=this.handlePacket(i+Kt,n,a,this.buffer);t(o),i+=c}else break}i===s?(this.buffer=Yt,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-i,this.bufferOffset=i)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let i;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)i=this.buffer;else{let n=this.buffer.byteLength*2;for(;t>=n;)n*=2;i=d.allocUnsafe(n)}this.buffer.copy(i,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=i,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,s,i){switch(t){case 50:return b.bindComplete;case 49:return b.parseComplete;case 51:return b.closeComplete;case 110:return b.noData;case 115:return b.portalSuspended;case 99:return b.copyDone;case 87:return b.replicationStart;case 73:return b.emptyQuery;case 68:return this.parseDataRowMessage(e,s,i);case 67:return this.parseCommandCompleteMessage(e,s,i);case 90:return this.parseReadyForQueryMessage(e,s,i);case 65:return this.parseNotificationMessage(e,s,i);case 82:return this.parseAuthenticationResponse(e,s,i);case 83:return this.parseParameterStatusMessage(e,s,i);case 75:return this.parseBackendKeyData(e,s,i);case 69:return this.parseErrorMessage(e,s,i,"error");case 78:return this.parseErrorMessage(e,s,i,"notice");case 84:return this.parseRowDescriptionMessage(e,s,i);case 116:return this.parseParameterDescriptionMessage(e,s,i);case 71:return this.parseCopyInMessage(e,s,i);case 72:return this.parseCopyOutMessage(e,s,i);case 100:return this.parseCopyData(e,s,i);default:Pr.default.fail(`unknown message code: ${t.toString(16)}`)}}parseReadyForQueryMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.string(1);return new b.ReadyForQueryMessage(t,i)}parseCommandCompleteMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.cstring();return new b.CommandCompleteMessage(t,i)}parseCopyData(e,t,s){let i=s.slice(e,e+(t-4));return new b.CopyDataMessage(t,i)}parseCopyInMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyInResponse")}parseCopyOutMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyOutResponse")}parseCopyMessage(e,t,s,i){this.reader.setBuffer(e,s);let n=this.reader.byte()!==0,a=this.reader.int16(),c=new b.CopyResponse(t,i,n,a);for(let o=0;o<a;o++)c.columnTypes[o]=this.reader.int16();return c}parseNotificationMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n=this.reader.cstring(),a=this.reader.cstring();return new b.NotificationResponseMessage(t,i,n,a)}parseRowDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new b.RowDescriptionMessage(t,i);for(let a=0;a<i;a++)n.fields[a]=this.parseField();return n}parseField(){let e=this.reader.cstring(),t=this.reader.int32(),s=this.reader.int16(),i=this.reader.int32(),n=this.reader.int16(),a=this.reader.int32(),c=this.reader.int16()===0?"text":"binary";return new b.Field(e,t,s,i,n,a,c)}parseParameterDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new b.ParameterDescriptionMessage(t,i);for(let a=0;a<i;a++)n.dataTypeIDs[a]=this.reader.int32();return n}parseDataRowMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int16(),n=new Array(i);for(let a=0;a<i;a++){let c=this.reader.int32();n[a]=c===-1?null:this.reader.string(c)}return new b.DataRowMessage(t,n)}parseParameterStatusMessage(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.cstring(),n=this.reader.cstring();return new b.ParameterStatusMessage(t,i,n)}parseBackendKeyData(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n=this.reader.int32();return new b.BackendKeyDataMessage(t,i,n)}parseAuthenticationResponse(e,t,s){this.reader.setBuffer(e,s);let i=this.reader.int32(),n={name:"authenticationOk",length:t};switch(i){case 0:break;case 3:n.length===8&&(n.name="authenticationCleartextPassword");break;case 5:if(n.length===12){n.name="authenticationMD5Password";let c=this.reader.bytes(4);return new b.AuthenticationMD5Password(t,c)}break;case 10:n.name="authenticationSASL",n.mechanisms=[];let a;do a=this.reader.cstring(),a&&n.mechanisms.push(a);while(a);break;case 11:n.name="authenticationSASLContinue",n.data=this.reader.string(t-8);break;case 12:n.name="authenticationSASLFinal",n.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+i)}return n}parseErrorMessage(e,t,s,i){this.reader.setBuffer(e,s);let n={},a=this.reader.string(1);for(;a!=="\0";)n[a]=this.reader.cstring(),a=this.reader.string(1);let c=n.M,o=i==="notice"?new b.NoticeMessage(t,c):new b.DatabaseError(c,t,i);return o.severity=n.S,o.code=n.C,o.detail=n.D,o.hint=n.H,o.position=n.P,o.internalPosition=n.p,o.internalQuery=n.q,o.where=n.W,o.schema=n.s,o.table=n.t,o.column=n.c,o.dataType=n.d,o.constraint=n.n,o.file=n.F,o.line=n.L,o.routine=n.R,o}};z.Parser=ht});var pt=M(C=>{"use strict";m();Object.defineProperty(C,"__esModule",{value:!0});C.DatabaseError=C.serialize=C.parse=void 0;var Sr=q();Object.defineProperty(C,"DatabaseError",{enumerable:!0,get:function(){return Sr.DatabaseError}});var Or=Vt();Object.defineProperty(C,"serialize",{enumerable:!0,get:function(){return Or.serialize}});var Ir=dt();function Cr(r,e){let t=new Ir.Parser;return r.on("data",s=>t.parse(s,e)),new Promise(s=>r.on("end",()=>s()))}C.parse=Cr});m();m();m();var Rr=new Error("timeout while waiting for mutex to become available"),Dr=new Error("mutex already locked"),es=new Error("request for lock canceled"),ts=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function c(u){try{h(s.next(u))}catch(_){a(_)}}function o(u){try{h(s.throw(u))}catch(_){a(_)}}function h(u){u.done?n(u.value):i(u.value).then(c,o)}h((s=s.apply(r,e||[])).next())})},Le=class{constructor(e,t=es){this._value=e,this._cancelError=t,this._weightedQueues=[],this._weightedWaiters=[]}acquire(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((t,s)=>{this._weightedQueues[e-1]||(this._weightedQueues[e-1]=[]),this._weightedQueues[e-1].push({resolve:t,reject:s}),this._dispatch()})}runExclusive(e,t=1){return ts(this,void 0,void 0,function*(){let[s,i]=yield this.acquire(t);try{return yield e(s)}finally{i()}})}waitForUnlock(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise(t=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),this._weightedWaiters[e-1].push(t),this._dispatch()})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatch()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatch()}cancel(){this._weightedQueues.forEach(e=>e.forEach(t=>t.reject(this._cancelError))),this._weightedQueues=[]}_dispatch(){var e;for(let t=this._value;t>0;t--){let s=(e=this._weightedQueues[t-1])===null||e===void 0?void 0:e.shift();if(!s)continue;let i=this._value,n=t;this._value-=t,t=this._value+1,s.resolve([i,this._newReleaser(n)])}this._drainUnlockWaiters()}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._weightedWaiters[e-1]&&(this._weightedWaiters[e-1].forEach(t=>t()),this._weightedWaiters[e-1]=[])}},ss=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function c(u){try{h(s.next(u))}catch(_){a(_)}}function o(u){try{h(s.throw(u))}catch(_){a(_)}}function h(u){u.done?n(u.value):i(u.value).then(c,o)}h((s=s.apply(r,e||[])).next())})},I=class{constructor(e){this._semaphore=new Le(1,e)}acquire(){return ss(this,void 0,void 0,function*(){let[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}};m();var pe,X,Lt;St&&typeof CustomEvent>"u"?pe=(Lt=class extends Event{constructor(t,s){super(t,s);y(this,X,void 0);w(this,X,s?.detail??null)}get detail(){return l(this,X)}},X=new WeakMap,Lt):pe=CustomEvent;var jt={};Pt(jt,{parseResults:()=>ve});m();var S=U(q(),1);var zt={};Pt(zt,{ABSTIME:()=>ys,ACLITEM:()=>vs,BIT:()=>Is,BOOL:()=>Ke,BPCHAR:()=>Ps,BYTEA:()=>ge,CHAR:()=>Bt,CID:()=>cs,CIDR:()=>ps,CIRCLE:()=>ws,DATE:()=>rt,FLOAT4:()=>et,FLOAT8:()=>tt,GTSVECTOR:()=>Qs,INET:()=>xs,INT2:()=>Ye,INT4:()=>Xe,INT8:()=>we,INTERVAL:()=>Ss,JSON:()=>be,JSONB:()=>at,MACADDR:()=>Ts,MACADDR8:()=>bs,MONEY:()=>Es,NUMERIC:()=>Rs,OID:()=>Ze,PATH:()=>hs,PG_DEPENDENCIES:()=>Gs,PG_LSN:()=>Us,PG_NDISTINCT:()=>qs,PG_NODE_TREE:()=>ls,POLYGON:()=>ds,REFCURSOR:()=>Ds,REGCLASS:()=>Bs,REGCONFIG:()=>$s,REGDICTIONARY:()=>Vs,REGNAMESPACE:()=>Hs,REGOPER:()=>As,REGOPERATOR:()=>Ls,REGPROC:()=>ns,REGPROCEDURE:()=>Ms,REGROLE:()=>Ws,REGTYPE:()=>Fs,RELTIME:()=>ms,SMGR:()=>fs,TEXT:()=>Je,TID:()=>as,TIME:()=>_s,TIMESTAMP:()=>it,TIMESTAMPTZ:()=>nt,TIMETZ:()=>Os,TINTERVAL:()=>gs,TSQUERY:()=>js,TSVECTOR:()=>zs,TXID_SNAPSHOT:()=>Ns,UUID:()=>ks,VARBIT:()=>Cs,VARCHAR:()=>st,XID:()=>os,XML:()=>us,arrayTypes:()=>ye,parseArray:()=>Gt,parseType:()=>xe,parsers:()=>kt,serializeType:()=>Te,serializerFor:()=>Ut,serializerInstanceof:()=>Nt,serializers:()=>me,types:()=>Ft});m();var rs=globalThis.JSON.parse,is=globalThis.JSON.stringify,Ke=16,ge=17,Bt=18,we=20,Ye=21,Xe=23,ns=24,Je=25,Ze=26,as=27,os=28,cs=29,be=114,us=142,ls=194,fs=210,hs=602,ds=604,ps=650,et=700,tt=701,ys=702,ms=703,gs=704,ws=718,bs=774,Es=790,Ts=829,xs=869,vs=1033,Ps=1042,st=1043,rt=1082,_s=1083,it=1114,nt=1184,Ss=1186,Os=1266,Is=1560,Cs=1562,Rs=1700,Ds=1790,Ms=2202,As=2203,Ls=2204,Bs=2205,Fs=2206,ks=2950,Ns=2970,Us=3220,qs=3361,Gs=3402,zs=3614,js=3615,Qs=3642,$s=3734,Vs=3769,at=3802,Hs=4089,Ws=4096,ye={1001:ge,1002:Bt,1016:we,1005:Ye,1007:Xe,1009:Je,1028:Ze,199:be,1021:et,1022:tt,1015:st,3807:at,1182:rt,1115:it,1116:nt},Ft={string:{to:0,from:[Je,st],serialize:r=>r,parse:r=>r},number:{to:0,from:[Ye,Xe,Ze,et,tt],serialize:r=>r.toString(),parse:r=>+r},bigint:{to:we,from:[we],js:[BigInt],serialize:r=>r.toString(),parse:r=>{let e=BigInt(r);return e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER?e:Number(e)}},json:{to:be,from:[be,at],serialize:r=>is(r),parse:r=>rs(r)},boolean:{to:Ke,from:[Ke],serialize:r=>r===!0?"t":"f",parse:r=>r==="t"},date:{to:1184,from:[rt,it,nt],js:[Date],serialize:r=>(r instanceof Date?r:new Date(r)).toISOString(),parse:r=>new Date(r)},bytea:{to:ge,from:[ge],js:[Uint8Array,d],serialize:r=>"\\x"+d.from(r).toString("hex"),parse:r=>new Uint8Array(d.from(r.slice(2),"hex"))},array:{to:0,from:Object.keys(ye).map(r=>+r),serialize:r=>qt(r),parse:(r,e)=>{let t;return e&&e in ye&&(t=kt[ye[e]]),Gt(r,t)}}},Ee=Ys(Ft),kt=Ee.parsers,me=Ee.serializers,Nt=Ee.serializerInstanceof;function Ut(r){if(Array.isArray(r))return me.array;let e=me[typeof r];if(e)return e;for(let[t,s]of Nt)if(r instanceof t)return s;return me.json}function Te(r){return r==null?[null,0]:Ut(r)(r)}function Ks(r){return'"'+r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function qt(r){let e="{";for(let t=0;t<r.length;t++)if(t>0&&(e=e+","),r[t]===null||typeof r[t]>"u")e=e+"NULL";else if(Array.isArray(r[t]))e=e+qt(r[t]);else if(ArrayBuffer.isView(r[t])){let s=r[t];if(!(s instanceof d)){let i=d.from(s.buffer,s.byteOffset,s.byteLength);i.length===s.byteLength?s=i:s=i.slice(s.byteOffset,s.byteOffset+s.byteLength)}e+="\\\\x"+s.toString("hex")}else e+=Ks(Te(r[t])[0]);return e=e+"}",e}function Gt(r,e){let t=0,s=null,i="",n=!1,a=0,c;function o(h){let u=[];for(;t<h.length;t++){if(s=h[t],n)s==="\\"?i+=h[++t]:s==='"'?(u.push(e?e(i):i),i="",n=h[t+1]==='"',a=t+2):i+=s;else if(s==='"')n=!0;else if(s==="{")a=++t,u.push(o(h));else if(s==="}"){n=!1,a<t&&u.push(e?e(h.slice(a,t)):h.slice(a,t)),a=t+1;break}else s===","&&c!=="}"&&c!=='"'&&(u.push(e?e(h.slice(a,t)):h.slice(a,t)),a=t+1);c=s}return a<t&&u.push(e?e(h.slice(a,t+1)):h.slice(a,t+1)),u}return o(r)[0]}function xe(r,e,t){if(r===null)return null;let s=t?.[e]??Ee.parsers[e];return s?s(r,e):r}function Ys(r){return Object.keys(r).reduce(({parsers:e,serializers:t,serializerInstanceof:s},i)=>{let{to:n,from:a,serialize:c,parse:o=null}=r[i],h=u=>[c(u),n];return t[n]=h,t[i]=h,r[i].js&&r[i].js.forEach(u=>s.push([u,h])),o&&(Array.isArray(a)?a.forEach(u=>e[u]=o):e[a]=o,e[i]=o),{parsers:e,serializers:t,serializerInstanceof:s}},{parsers:{},serializers:{},serializerInstanceof:[]})}function ve(r,e,t){let s=[],i={rows:[],fields:[]},n=0,a=r.filter(c=>c instanceof S.RowDescriptionMessage||c instanceof S.DataRowMessage||c instanceof S.CommandCompleteMessage);return a.forEach((c,o)=>{c instanceof S.RowDescriptionMessage?i.fields=c.fields.map(h=>({name:h.name,dataTypeID:h.dataTypeID})):c instanceof S.DataRowMessage&&i?e?.rowMode==="array"?i.rows.push(c.fields.map((h,u)=>xe(h,i.fields[u].dataTypeID,e?.parsers))):i.rows.push(Object.fromEntries(c.fields.map((h,u)=>[i.fields[u].name,xe(h,i.fields[u].dataTypeID,e?.parsers)]))):c instanceof S.CommandCompleteMessage&&(n+=Xs(c),o===a.length-1?s.push({...i,affectedRows:n,...t?{blob:t}:{}}):s.push(i),i={rows:[],fields:[]})}),s.length===0&&s.push({rows:[],fields:[]}),s}function Xs(r){let e=r.text.split(" ");switch(e[0]){case"INSERT":return parseInt(e[2],10);case"UPDATE":case"DELETE":return parseInt(e[1],10);default:return 0}}var O=U(pt(),1),yt=U(dt(),1),D=U(q(),1);var j,Z,Q,$,A,L,B,ee,te,F,Ce,se,V,Re,H,re,W,x,v,k,De,Jt,ie,mt,Me,Zt,ne,gt,E,T,ae,wt,oe,bt,N,J,P,R,K,Ie,ce,Et,Tt=class Tt{constructor(e={},t={}){y(this,De);y(this,ie);y(this,Me);y(this,ne);y(this,E);y(this,ae);y(this,oe);y(this,N);y(this,P);y(this,K);y(this,ce);y(this,j,void 0);y(this,Z,!1);y(this,Q,!1);y(this,$,void 0);y(this,A,!1);y(this,L,!1);y(this,B,!1);y(this,ee,!1);y(this,te,[]);y(this,F,[]);y(this,Ce,new I);y(this,se,new I);y(this,V,new I);y(this,Re,new I);y(this,H,!1);this.debug=0;y(this,re,new yt.Parser);y(this,W,void 0);y(this,x,void 0);y(this,v,new Map);y(this,k,new Set);typeof e=="string"?t={dataDir:e,...t}:t=e,t?.debug!==void 0&&(this.debug=t.debug),t?.relaxedDurability!==void 0&&w(this,ee,t.relaxedDurability),w(this,$,new EventTarget),l(this,$).addEventListener("result",async s=>{l(this,F).push(s.detail)}),w(this,j,t.extensions??{}),this.waitReady=p(this,De,Jt).call(this,t??{})}async addExtension(e,t){if(!this.emp)throw new Error("Can not add extensions before wasm module initialization");return p(this,ie,mt).call(this,this.emp,e,t)}get ready(){return l(this,Q)&&!l(this,A)&&!l(this,L)}get closed(){return l(this,L)}async close(){await p(this,N,J).call(this),w(this,A,!0);for(let e of l(this,te))await e();await new Promise(async(e,t)=>{try{await this.execProtocol(O.serialize.end())}catch(s){let i=s;i.name==="ExitStatus"&&i.status===0?e():t(s)}}),w(this,L,!0),w(this,A,!1)}async query(e,t,s){return await p(this,N,J).call(this),await l(this,V).runExclusive(async()=>await p(this,ne,gt).call(this,e,t,s))}async exec(e,t){return await p(this,N,J).call(this),await l(this,V).runExclusive(async()=>await p(this,E,T).call(this,e,t))}async transaction(e){return await p(this,N,J).call(this),await l(this,V).runExclusive(async()=>{await p(this,E,T).call(this,"BEGIN");let t=!1,s=()=>{if(t)throw new Error("Transaction is closed")};try{let n=await e({query:async(a,c,o)=>(s(),await p(this,ne,gt).call(this,a,c,o)),exec:async(a,c)=>(s(),await p(this,E,T).call(this,a,c)),rollback:async()=>{s(),await p(this,E,T).call(this,"ROLLBACK"),t=!0},get closed(){return t}});return t||(t=!0,await p(this,E,T).call(this,"COMMIT")),n}catch(i){throw t||await p(this,E,T).call(this,"ROLLBACK"),i}})}async execProtocol(e,{syncToFs:t=!0}={}){return await l(this,Ce).runExclusive(async()=>{l(this,F).length>0&&w(this,F,[]);var s=e.length,i=this.emp.___libc_malloc(s);this.emp.HEAPU8.set(e,i),await this.emp.ccall("ExecProtocolMsg","void",["pointer"],[i],{async:!0}),t&&await p(this,K,Ie).call(this);let n=l(this,F),a=[];return n.forEach(c=>{l(this,re).parse(d.from(c),o=>{if(o instanceof D.DatabaseError)throw w(this,re,new yt.Parser),o;if(o instanceof D.NoticeMessage&&this.debug>0)console.warn(o);else if(o instanceof D.CommandCompleteMessage)switch(o.text){case"BEGIN":w(this,B,!0);break;case"COMMIT":case"ROLLBACK":w(this,B,!1);break}else if(o instanceof D.NotificationResponseMessage){let h=l(this,v).get(o.channel);h&&h.forEach(u=>{queueMicrotask(()=>u(o.payload))}),l(this,k).forEach(u=>{queueMicrotask(()=>u(o.channel,o.payload))})}a.push([o,c])})}),a})}async listen(e,t){return l(this,v).has(e)||l(this,v).set(e,new Set),l(this,v).get(e).add(t),await this.exec(`LISTEN ${e}`),async()=>{await this.unlisten(e,t)}}async unlisten(e,t){t?(l(this,v).get(e)?.delete(t),l(this,v).get(e).size===0&&(await this.exec(`UNLISTEN ${e}`),l(this,v).delete(e))):(await this.exec(`UNLISTEN ${e}`),l(this,v).delete(e))}onNotification(e){return l(this,k).add(e),()=>{l(this,k).delete(e)}}offNotification(e){l(this,k).delete(e)}static withExtensions(e){return new Tt(e)}};j=new WeakMap,Z=new WeakMap,Q=new WeakMap,$=new WeakMap,A=new WeakMap,L=new WeakMap,B=new WeakMap,ee=new WeakMap,te=new WeakMap,F=new WeakMap,Ce=new WeakMap,se=new WeakMap,V=new WeakMap,Re=new WeakMap,H=new WeakMap,re=new WeakMap,W=new WeakMap,x=new WeakMap,v=new WeakMap,k=new WeakMap,De=new WeakSet,Jt=async function(e){if(e.fs)this.fs=e.fs;else{let{dataDir:i,fsType:n}=Mt(e.dataDir);this.fs=await At(i,n)}let t=[],s=!1;await new Promise(async(i,n)=>{if(l(this,Z))throw new Error("Already initializing");w(this,Z,!0),s=await this.fs.init(this.debug);let a={arguments:["--single","-F","-O","-j","-c","search_path=pg_catalog","-c","dynamic_shared_memory_type=mmap","-c","max_prepared_transactions=10",...this.debug?["-d",this.debug.toString()]:[],"-D","/pgdata","template1"],locateFile:await Dt(),...this.debug>0?{print:console.info,printErr:console.error}:{print:()=>{},printErr:()=>{}},preRun:[o=>{let h=o.FS.makedev(64,0),u=0,_={open:ue=>{},close:ue=>{},read:(ue,le,Y,fe,he)=>{let xt=l(this,W);if(!xt)throw new Error("No File or Blob provided to read from");let Ae=new Uint8Array(xt);if(he>=Ae.length)return 0;let vt=Math.min(Ae.length-he,fe);for(let de=0;de<vt;de++)le[Y+de]=Ae[he+de];return vt},write:(ue,le,Y,fe,he)=>(u++,l(this,x)??w(this,x,[]),l(this,x).push(le.slice(Y,Y+fe)),fe),llseek:(ue,le,Y)=>{throw new Error("Cannot seek /dev/blob")}};o.FS.registerDevice(h,_),o.FS.mkdev("/dev/blob",h)}],onRuntimeInitialized:async o=>{await Promise.all(Object.entries(l(this,j)).map(([h,u])=>{if(u.pathOrUrl)return p(this,ie,mt).call(this,o,h,u)})),await this.fs.initialSyncFs(o.FS),w(this,Q,!0),i()},eventTarget:l(this,$),Event:pe};for(let[o,h]of Object.entries(l(this,j))){if(h.pathOrUrl)continue;let u=await h.setup(this,a);u.emscriptenOpts&&(a=u.emscriptenOpts),u.namespaceObj&&(this[o]=u.namespaceObj),u.init&&t.push(u.init),u.close&&l(this,te).push(u.close)}a=await this.fs.emscriptenOpts(a);let c=await _t(a);this.emp=c}),s&&await p(this,Me,Zt).call(this),await p(this,E,T).call(this,`
      SET search_path TO public;
    `);for(let i of t)await i()},ie=new WeakSet,mt=async function(e,t,s){let i=`/usr/local/pgsql/share/extension/${t}.control`;if(It(e.FS,i))return;let n=await Ct(s,t),a=Ot(n);if(!a)throw new Error(`Invalid control file for extension ${t}`);let c=`${t}--${a}.sql`,o=`${s.pathOrUrl}/${c}`,h=await Rt(s,t,o);if(!h)throw new Error(`Invalid SQL file for extension ${t}`);e.FS.writeFile(i,n),e.FS.writeFile(`/usr/local/pgsql/share/extension/${c}`,h)},Me=new WeakSet,Zt=async function(){let e="/usr/local/pgsql/share",t=[["information_schema.sql"],["system_constraints.sql","pg_catalog"],["system_functions.sql","pg_catalog"],["system_views.sql","pg_catalog"]];for(let[s,i]of t){let n=await this.emp.FS.readFile(e+"/"+s,{encoding:"utf8"});i?await p(this,E,T).call(this,`SET search_path TO ${i};
 ${n}`):await p(this,E,T).call(this,n)}await p(this,E,T).call(this,`
      SET search_path TO public;
      CREATE EXTENSION IF NOT EXISTS plpgsql;
    `)},ne=new WeakSet,gt=async function(e,t,s){return await l(this,se).runExclusive(async()=>{p(this,ce,Et).call(this,"runQuery",e,t,s),await p(this,ae,wt).call(this,s?.blob);let i=t?.map(c=>Te(c))||[],n;try{n=[...await p(this,P,R).call(this,O.serialize.parse({text:e,types:i.map(([,c])=>c)})),...await p(this,P,R).call(this,O.serialize.bind({values:i.map(([c])=>c)})),...await p(this,P,R).call(this,O.serialize.describe({type:"P"})),...await p(this,P,R).call(this,O.serialize.execute({}))]}finally{await p(this,P,R).call(this,O.serialize.sync())}p(this,oe,bt).call(this),l(this,B)||await p(this,K,Ie).call(this);let a;return l(this,x)&&(a=new Blob(l(this,x)),w(this,x,void 0)),ve(n.map(([c])=>c),s,a)[0]})},E=new WeakSet,T=async function(e,t){return await l(this,se).runExclusive(async()=>{p(this,ce,Et).call(this,"runExec",e,t),await p(this,ae,wt).call(this,t?.blob);let s;try{s=await p(this,P,R).call(this,O.serialize.query(e))}finally{await p(this,P,R).call(this,O.serialize.sync())}p(this,oe,bt).call(this),l(this,B)||await p(this,K,Ie).call(this);let i;return l(this,x)&&(i=new Blob(l(this,x)),w(this,x,void 0)),ve(s.map(([n])=>n),t,i)})},ae=new WeakSet,wt=async function(e){w(this,W,e?await e.arrayBuffer():void 0)},oe=new WeakSet,bt=function(){w(this,W,void 0)},N=new WeakSet,J=async function(){if(l(this,A))throw new Error("PGlite is closing");if(l(this,L))throw new Error("PGlite is closed");l(this,Q)||await this.waitReady},P=new WeakSet,R=async function(e){return await this.execProtocol(e,{syncToFs:!1})},K=new WeakSet,Ie=async function(){if(l(this,H))return;w(this,H,!0);let e=async()=>{await l(this,Re).runExclusive(async()=>{w(this,H,!1),await this.fs.syncToFs(this.emp.FS)})};l(this,ee)?e():await e()},ce=new WeakSet,Et=function(...e){this.debug>0&&console.log(...e)};var Xt=Tt;m();var Ti=U(q(),1),xi=U(pt(),1);export{I as a,zt as b,jt as c,Xt as d,Ti as e,xi as f};
//# sourceMappingURL=chunk-NTMOV32R.js.map